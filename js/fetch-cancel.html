<!doctype html>
<html lang="vi">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>[OFF] fetch-cancel</title>
  <style>
    :root { --bg:#0b1020; --card:#11182b; --muted:#9aa3b2; --accent:#6ea8fe; --txt:#e7eaf1; }
    body { margin:0; font:14px/1.5 ui-sans-serif, system-ui; background:var(--bg); color:var(--txt); }
    .wrap { max-width:880px; margin:24px auto; padding:16px; }
    .card { background:var(--card); border:1px solid #1f263b; border-radius:14px; padding:16px; margin:12px 0; }
    h1, h2 { margin:0 0 8px; }
    .row { display:flex; gap:8px; align-items:center; flex-wrap:wrap; }
    .muted { color: var(--muted) }
    pre { background:#0f1629; padding:10px; border-radius:8px; overflow:auto; }
    button { cursor:pointer }
    
  </style>
</head>
<body>
<div class="wrap">
  <!-- Trace Map
  Feature: fetch-cancel
  Flow: UI -> state -> pure -> effects
  Tests: bấm trong khu vực 🧪
  Gotchas: ...
  -->
  <h1>[OFF] fetch-cancel</h1>
  
<section class="card">
  <h2>🎯 Demo Fetch + Cancel</h2>
  <div class="row">
    <button id="start">Fetch</button>
    <button id="cancel">Cancel</button>
    <span id="status" class="muted"></span>
  </div>
  <pre id="out"></pre>
</section>

</div>
<script>

let controller = null;
const statusEl = document.getElementById('status');
const out = document.getElementById('out');

document.getElementById('start').onclick = async () => {
  out.textContent='';
  controller = new AbortController();
  statusEl.textContent = 'Đang tải…';
  try{
    const res = await fetch('https://jsonplaceholder.typicode.com/todos/1', { signal: controller.signal });
    const data = await res.json();
    out.textContent = JSON.stringify(data, null, 2);
    statusEl.textContent = 'Xong ✅';
  }catch(e){
    statusEl.textContent = e.name === 'AbortError' ? 'Đã huỷ ⛔' : ('Lỗi: '+e.message);
  }
};

document.getElementById('cancel').onclick = () => {
  if(controller){ controller.abort(); controller = null; }
};

</script>
</body>
</html>
